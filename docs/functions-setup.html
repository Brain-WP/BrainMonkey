<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="author" content="Giuseppe Mazzapica">
    <title>PHP Functions / Setup Brain Monkey. Brain Monkey</title>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300|Source+Code+Pro:400' rel='stylesheet' type='text/css'>
    <link href="https://brain-wp.github.io/BrainMonkey/css/theme.min.css" rel="stylesheet">
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

    <div id="wrapper">

      <!-- Sidebar -->
      <div id="sidebar-wrapper">

          <div class="logo">
              <a href="https://brain-wp.github.io/BrainMonkey">
                <img src="https://brain-wp.github.io/BrainMonkey/images/brain-monkey-80.png" alt="Brain Monkey">
                <span>Brain Monkey</span>
              </a>
          </div>

          <ul class="sidebar-nav">
                                                  <li>
                        <a class="section" href="#sidebar-wrapper"><i class="fa fa-caret-right"></i> Getting Started</a>
                        <ul>
                                                            <li class="">
                                    <a href="https://brain-wp.github.io/BrainMonkey/docs/installation.html">
                                        Installation
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="https://brain-wp.github.io/BrainMonkey/docs/what-and-why.html">
                                        What & Why
                                    </a>
                                </li>
                                                    </ul>
                    </li>
                                    <li>
                        <a class="section" href="#sidebar-wrapper"><i class="fa fa-caret-right"></i> PHP Functions</a>
                        <ul>
                                                            <li class="active">
                                    <a href="https://brain-wp.github.io/BrainMonkey/docs/functions-setup.html">
                                        Setup
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="https://brain-wp.github.io/BrainMonkey/docs/functions-when.html">
                                        Patching with when()
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="https://brain-wp.github.io/BrainMonkey/docs/functions-stubs.html">
                                        Bulk patching with stubs()
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="https://brain-wp.github.io/BrainMonkey/docs/functions-expect.html">
                                        Testing with expect()
                                    </a>
                                </li>
                                                    </ul>
                    </li>
                                    <li>
                        <a class="section" href="#sidebar-wrapper"><i class="fa fa-caret-right"></i> WordPress</a>
                        <ul>
                                                            <li class="">
                                    <a href="https://brain-wp.github.io/BrainMonkey/docs/wordpress-why-bother.html">
                                        Why Bother
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="https://brain-wp.github.io/BrainMonkey/docs/wordpress-setup.html">
                                        Setup
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="https://brain-wp.github.io/BrainMonkey/docs/wordpress-tools.html">
                                        WordPress Testing Tools
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="https://brain-wp.github.io/BrainMonkey/docs/wordpress-hooks-added.html">
                                        Testing Added Hooks
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="https://brain-wp.github.io/BrainMonkey/docs/wordpress-hooks-done.html">
                                        Testing Fired Hooks
                                    </a>
                                </li>
                                                    </ul>
                    </li>
                                    <li>
                        <a class="section" href="#sidebar-wrapper"><i class="fa fa-caret-right"></i> Migration</a>
                        <ul>
                                                            <li class="">
                                    <a href="https://brain-wp.github.io/BrainMonkey/docs/migrating-from-v1.html">
                                        Migrating From Version 1
                                    </a>
                                </li>
                                                    </ul>
                    </li>
                                        </ul>

      </div>
      <!-- /#sidebar-wrapper -->

        <!-- Page Content -->
        <div id="page-content-wrapper" class="content-wrapper-">
            <div class="container-fluid">
                <div class="row">
                    <div id="content" class="col-lg-11">
                                                                                <ol class="breadcrumb">
                              <li><a href="https://brain-wp.github.io/BrainMonkey">Brain Monkey</a></li>
                              <li class="active">PHP Functions</li>
                            </ol>
                                                                                                        <h1 id="testing-php-functions-setup-brain-monkey">Testing PHP Functions: Setup Brain Monkey</h1>
<h2 id="testing-framework-agnostic">Testing framework agnostic</h2>
<p>Brain Monkey can be used with any testing framework.</p>
<p>Examples in this page will use PHPUnit, but the concepts are applicable at any testing framework.</p>
<h2 id="warning">Warning</h2>
<p>Brain Monkey uses <a href="http://patchwork2.org/">Patchwork</a> to redefine functions.</p>
<p>Brain Monkey 2.* requires Patchwork 2 which allows to re-define both userland and core functions,
with some <a href="http://patchwork2.org/limitations/">limitations</a>.</p>
<p>The main limitations that affects Brain Monkey are (from Patchwork website):</p>
<ul>
<li><em>Patchwork will fail on every attempt to redefine an internal function that is missing from the redefinable-internals array of your <code>patchwork.json</code>.</em></li>
<li><em>Make sure that Patchwork is imported as early as possible, since any files imported earlier, including the one from which the importing takes place, will be missed by Patchwork's code preprocessor.</em></li>
</ul>
<h2 id="setup-tests">Setup tests</h2>
<p>After Brain Monkey is part of the project (see <em>Getting Started / Installation</em>), to be able to use its features
two simple steps are needed before being able to use Brain Monkey in tests:</p>
<ol>
<li>be sure to require Composer autoload file <em>before</em> running tests (e.g. PHPUnit users will probably require it in their bootstrap file).</li>
<li>call the function <code>Brain\Monkey\tearDown()</code> after any test</li>
</ol>
<h3 id="phpunit-example">PHPUnit example</h3>
<p>Let's take PHPUnit as example, the average test case class that uses Brain Monkey would be something like:</p>
<pre><code class="language-php">use PHPUnit_Framework_TestCase;
use Brain\Monkey;

class MyTestCase extends PHPUnit_Framework_TestCase
{

    protected function tearDown()
    {
        Monkey\tearDown();
        parent::tearDown();
    }
}</code></pre>
<p>After that for all test classes can extend this class instead of directly extending <code>PHPUnit_Framework_TestCase</code>.</p>
<p>That's all. Again, I used PHPUnit for the example, but any testing framework can be used.</p>
<p>For function mocking and testing there are two entry-point functions:</p>
<ul>
<li><strong><code>Functions\when()</code></strong> </li>
<li><strong><code>Functions\expect()</code></strong></li>
</ul>
<p>See dedicated documentation pages.</p>
<h2 id="namespaced-functions">Namespaced functions</h2>
<p>All the code examples in this documentation make use of functions in global namespace.</p>
<p>However, note that namespaced functions are supported as well, just be sure to pass the fully qualified name of the functions:</p>
<pre><code class="language-php">Functions\expect('a_global_function');

Functions\expect('My\\App\\awesome_function');</code></pre>
<h2 id="note-for-wordpressers">Note for WordPressers</h2>
<p>Anything said in this page is fine for WordPress functions too, they are PHP functions, after all.</p>
<p>However, Brain Monkey has specific features for WordPress, and there is a way to setup tests for <strong>all</strong> Brain Monkey features (WordPress-specific and not).</p>
<p><strong>If you want to use Brain Monkey to test code wrote for WordPress, it is preferable to use the setup explained in the <em>&quot;WordPress / Setup&quot;</em> section that <em>includes</em> the setup needed to use Brain Monkey tools for functions.</strong></p>
                                            </div>
                </div>
            </div>
        </div>
        <!-- /#page-content-wrapper -->

                    <a href="https://github.com/Brain-WP/BrainMonkey">
                <img style="position:fixed; top:0; right:0; border:0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png">
            </a>
                <a href="#" id="menu-toggle" title="Toggle Menu"><i class="fa fa-bars"></i></a>


    </div>
    <!-- /#wrapper -->

    <footer class="footer hidden-xs hidden-sm">
      Made by hands by
      <a href="https://gmazzap.me/" title="Giuseppe Mazzapica Home Page" target="_blank">Giuseppe Mazzapica</a>, with
      <a href="http://couscous.io/" title="Couscous" target="_blank">Couscous</a>,
      <a href="https://getbootstrap.com/" title="Bootstrap" target="_blank">Bootstrap</a> &amp;
      <a href="https://highlightjs.org/" title="highlight.js" target="_blank">highlight.js</a>

      <span class="socials">
        <a href="https://github.com/gmazzap" title="GitHub" target="_blank"><i class="fa fa-github-alt"></i></a>
        <a href="https://twitter.com/gmazzap" title="Twitter" target="_blank"><i class="fa fa-twitter"></i></a>
        <a href="https://wordpress.stackexchange.com/users/35541/" title="Stack Exchange" target="_blank"><i class="fa fa-stack-exchange"></i></a>
      </span>

    </footer>

    <a href="#wrapper" class="hidden-xs hidden-sm" id="back-top" title="Back to top"><i class="fa fa-long-arrow-up"></i></a>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="https://brain-wp.github.io/BrainMonkey/js/theme.min.js"></script>
    </body>

</html>
